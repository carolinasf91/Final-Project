---
title: "Final Project Code"
author: "Csilva07"
date: "2025-05-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Packages

```{r}
install.packages("ggplot2")
install.packages("tidyr")
install.packages("ROCR")
install.packages("dplyr")
install.packages("stringr")
install.packages("broom")
library(dplyr)
library(ggplot2)
library(tidyr)
library(ROCR)
library(stringr)
library(broom)
```

## Repeated functions

```{r}
#Standardise NCMP year from 2XXX/XX to 2XXX
clean_year <- function(df, year_col = "NCMP.Year") {
  df %>%
    rename(Year = all_of(year_col)) %>%
    mutate(
      Year = as.numeric(str_extract(Year, "^[0-9]{4}"))
      )
}

#Replace NA with 0 
replace_na_with_zero <- function(df, columns) {
  df %>%
    mutate(
      across(all_of(columns), ~ ifelse(is.na(.), 0, .))
      )
}

#Calculate obesity progression risk
get_progression_risk <- function(df, prevalence_col = "Obesity.Prevalence") {
  df %>%
    pivot_wider(names_from = School.Year, values_from = !!sym(prevalence_col)) %>%
    filter(!is.na(Reception) & !is.na(`Year 6`)) %>%
    mutate(
      Progression_Risk = `Year 6` - Reception
      )
}

#My plot theme
my_theme <- function() {
  theme_minimal(base_size = 13) +
    theme(axis.text.x = element_text(angle = 45, hjust = 1),
          strip.text = element_text(face = "bold"))
}

#Calculate prevalence
calculate_prevalence <- function(x, total) {
  return(100 * x / total)
}
```
